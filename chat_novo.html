<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>ANARCROOM</title>
  <link rel="stylesheet" href="static/anarcroom.css">
</head>
<body>

<div class="container">
  <h1>ANARCROOM</h1>
  <p id="roomLabel"></p>

  <div id="joinSection">
    <input id="user" placeholder="Username">
    <button onclick="entrar()">Entrar</button>
  </div>

  <div id="chat" style="display:none">
    <div id="messages"></div>
    <input id="msg" placeholder="Mensagem">
    <button onclick="enviar()">Enviar</button>
    <br><br>
    <a href="index.html">← Sair</a>
  </div>
</div>

<script>
// Client-only room chat using localStorage — works on GitHub Pages
const params = new URLSearchParams(window.location.search);
const room = params.get('room') || 'default';
document.getElementById('roomLabel').textContent = 'Sala: ' + room;

let username = '';
function loadMessages() {
  const key = 'anarcroom_msgs_' + room;
  const arr = JSON.parse(localStorage.getItem(key) || '[]');
  const c = document.getElementById('messages');
  c.innerHTML = '';
  arr.forEach(m => {
    const p = document.createElement('p');
    const t = new Date(m.time).toLocaleTimeString();
    p.textContent = `[${t}] ${m.user}: ${m.msg}`;
    c.appendChild(p);
  });
  c.scrollTop = c.scrollHeight;
}

window.entrar = function(){
  username = document.getElementById('user').value.trim();
  if(!username) return alert('Escolhe um nome');
  document.getElementById('joinSection').style.display = 'none';
  document.getElementById('chat').style.display = 'block';
  loadMessages();
};

window.enviar = function(){
  const txtEl = document.getElementById('msg');
  const txt = txtEl.value.trim();
  if(!txt) return;
  const key = 'anarcroom_msgs_' + room;
  const arr = JSON.parse(localStorage.getItem(key) || '[]');
  arr.push({user: username, msg: txt, time: Date.now()});
  localStorage.setItem(key, JSON.stringify(arr));
  txtEl.value = '';
  loadMessages();
};

document.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && document.activeElement.id === 'msg') enviar();
});
</script>
</body>
</html>
